<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
        http://www.springframework.org/schema/batch D:\\DEV\\xsd\\spring-batch-3.0.xsd">

    <import resource="../abstract/eGovBase.xml" />

    <!-- STG에 적재된 ERP 차량 정보를 로컬 DB로 이관하는 잡 -->
    <job id="erpStgToLocalJob" parent="eGovBaseJob" xmlns="http://www.springframework.org/schema/batch">
        <step id="stgToLocalStep" parent="eGovBaseStep">
            <tasklet>
                <chunk reader="erpStgToLocalJob.stgToLocalStep.mybatisItemReader"
                       processor="erpStgToLocalJob.stgToLocalStep.itemProcessor"
                       writer="erpStgToLocalJob.stgToLocalStep.mybatisItemWriter"
                       commit-interval="500" />
            </tasklet>
        </step>
    </job>

    <bean id="erpStgToLocalJob.stgToLocalStep.mybatisItemReader" class="org.egovframe.rte.bat.core.item.database.EgovMyBatisPagingItemReader" scope="step">
        <!-- STG DB에서 ERP 차량 정보를 조회 -->
        <property name="sqlSessionFactory" ref="sqlSessionFactory-erp-stg-local" />
        <property name="queryId" value="Vehicle.selectVehicleList" />
        <property name="pageSize" value="#{100}" />
    </bean>

    <bean id="erpStgToLocalJob.stgToLocalStep.mybatisItemWriter" class="org.egovframe.rte.bat.core.item.database.EgovMyBatisBatchItemWriter">
        <!-- 로컬 DB에 ERP 차량 정보 적재 -->
        <property name="sqlSessionFactory" ref="sqlSessionFactory-erp-local" />
        <property name="statementId" value="Vehicle.insertVehicleLocal" />
    </bean>

    <!-- 차량 정보 후처리를 위한 프로세서 -->
    <bean id="erpStgToLocalJob.stgToLocalStep.itemProcessor"
          class="egovframework.bat.erp.processor.VehicleInfoProcessor"
          scope="step" />

</beans>
