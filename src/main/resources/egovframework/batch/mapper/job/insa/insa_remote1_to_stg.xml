<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="insaRemToStg">

        <!-- 조직 정보 목록 조회 -->
        <select id="selectOrgnztList" resultType="egovframework.bat.job.insa.domain.Orgnztinfo">
                SELECT
                         ORGNZT_ID,
                         ORGNZT_NM,
                         ORGNZT_DC
                FROM COMTNORGNZTINFO
        </select>

        <!-- remote1 DB에서 STG 이관 시 ESNTL_ID와 SOURCE_SYSTEM을 제외하여 조회 -->
        <select id="selectEmployeeList" resultType="egovframework.bat.job.insa.domain.EmployeeInfo">
                SELECT
                         EMPLYR_ID,
                         ORGNZT_ID,
                         USER_NM,
                         SEXDSTN_CODE,
                         BRTHDY,
                         MBTLNUM,
                         EMAIL_ADRES,
                         OFCPS_NM,
                         EMPLYR_STTUS_CODE,
                         REG_DTTM,
                         MOD_DTTM
                FROM COMTNEMPLYRINFO
                <where>
                        <if test="lastEmplyrId != null">
                                EMPLYR_ID &gt; #{lastEmplyrId}
                        </if>
                </where>
                ORDER BY EMPLYR_ID
        </select>

       <!-- STG DB에 조직 정보 적재 (STG 대상 테이블이 사전 TRUNCATE되므로 중복 갱신 없음) -->
       <insert id="insertOrganization" parameterType="egovframework.bat.job.insa.domain.EmployeeInfo">
               INSERT INTO migstg.COMTNORGNZTINFO (ORGNZT_ID, ORGNZT_NM, ORGNZT_DC)
               VALUES (#{orgnztId}, #{orgnztNm}, #{orgnztDc})
       </insert>

       <!-- remote1 -> STG 이관 시 사용 (ESNTL_ID 제외, STG 대상 테이블이 사전 TRUNCATE되므로 중복 갱신 없음) -->
       <insert id="insertEmployee" parameterType="egovframework.bat.job.insa.domain.EmployeeInfo">
               INSERT INTO migstg.COMTNEMPLYRINFO
                       (EMPLYR_ID, ORGNZT_ID, USER_NM, SEXDSTN_CODE, BRTHDY, MBTLNUM, EMAIL_ADRES, OFCPS_NM, EMPLYR_STTUS_CODE, REG_DTTM, MOD_DTTM)
               VALUES
                       (#{emplyrId}, #{orgnztId}, #{userNm}, #{sexdstnCode}, #{brthdy}, #{mbtlnum}, #{emailAdres}, #{ofcpsNm}, #{emplyrSttusCode}, #{regDttm}, #{modDttm})
       </insert>

       <!-- 스테이징 테이블 초기화: 조직 정보 -->
       <update id="truncateOrgnztInfo">
               TRUNCATE TABLE migstg.comtnorgnztinfo
       </update>

       <!-- 스테이징 테이블 초기화: 사원 정보 -->
       <update id="truncateEmplyrInfo">
               TRUNCATE TABLE migstg.comtnemplyrinfo
       </update>

</mapper>
