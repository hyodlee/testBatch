<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="riskRemToStg">

    <!-- 리스크 카테고리 목록 조회 -->
    <select id="selectCategoryList" resultType="egovframework.bat.job.risk.domain.RiskCategory">
        SELECT
            CATEGORY_ID,
            CATEGORY_NAME,
            CATEGORY_DESC AS categoryDescription
        FROM RISK_CATEGORY
    </select>

    <!-- 리스크 사건 목록 조회 -->
    <select id="selectIncidentList" resultType="egovframework.bat.job.risk.domain.RiskIncident">
        SELECT
            INCIDENT_ID,
            INCIDENT_NO,
            CATEGORY_ID,
            TITLE,
            RISK_LEVEL,
            STATUS,
            OWNER_ID,
            DESCRIPTION,
            OCCURRED_AT,
            UPDATED_AT
        FROM RISK_INCIDENT
    </select>

    <!-- STG에 리스크 카테고리 저장 -->
    <insert id="insertCategory" parameterType="egovframework.bat.job.risk.domain.RiskCategory">
        INSERT INTO migstg.RISK_CATEGORY (CATEGORY_ID, CATEGORY_NAME, CATEGORY_DESC)
        VALUES (#{categoryId}, #{categoryName}, #{categoryDescription})
    </insert>

    <!-- STG에 리스크 사건 저장 -->
    <insert id="insertIncident" parameterType="egovframework.bat.job.risk.domain.RiskIncident">
        INSERT INTO migstg.RISK_INCIDENT (
            INCIDENT_ID,
            INCIDENT_NO,
            CATEGORY_ID,
            TITLE,
            RISK_LEVEL,
            STATUS,
            OWNER_ID,
            DESCRIPTION,
            OCCURRED_AT,
            UPDATED_AT)
        VALUES (
            #{incidentId},
            #{incidentNo},
            #{categoryId},
            #{title},
            #{riskLevel},
            #{status},
            #{ownerId},
            #{description},
            #{occurredAt},
            #{updatedAt})
    </insert>

    <!-- 스테이징 카테고리 초기화 -->
    <update id="truncateRiskCategory">
        TRUNCATE TABLE migstg.RISK_CATEGORY
    </update>

    <!-- 스테이징 사건 초기화 -->
    <update id="truncateRiskIncident">
        TRUNCATE TABLE migstg.RISK_INCIDENT
    </update>

</mapper>
